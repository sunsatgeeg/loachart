var reward_bonus_array = [
                            {
                                "bossname":"아르고스",
                                "bossitem":"",
                                "phase":3,
                                "phaserewardgold":[700,400,500], 
                                "phasebonusrewardgold":[0,0,500], 
                                "phaserewarditem":[0,0,0], 
                                "phasebonusrewarditem":[
                                                        [],
                                                        [],
                                                        [
                                                            ["수호석 결정",240],
                                                            ["파괴석 결정",120],
                                                            ["명예의 파편",720],
                                                            ["위대한 명예의 돌파석",5]
                                                        ]
                                                        ]
                            },
                            {
                                "bossname":"발탄(노말)",
                                "bossitem":"마수의 뼈",
                                "phase":2,
                                "phaserewardgold":[500,2000],
                                "phasebonusrewardgold":[500,800],
                                "phaserewarditem":[1,2],
                                "phasebonusrewarditem":[
                                                        [
                                                            ["수호석 결정",480],
                                                            ["파괴석 결정",240],
                                                            ["명예의 파편",400],
                                                            ["위대한 명예의 돌파석",6],
                                                            ["마수의 뼈",1]
                                                        ],
                                                        [
                                                            ["수호석 결정",600],
                                                            ["파괴석 결정",300],
                                                            ["명예의 파편",700],
                                                            ["위대한 명예의 돌파석",7],
                                                            ["마수의 뼈",1]
                                                        ]
                                                        ]
                            },
                            {
                                "bossname":"발탄(하드)",
                                "bossitem":"마수의 뼈",
                                "phase":2,
                                "phaserewardgold":[1000,3500],
                                "phasebonusrewardgold":[900,1200],
                                "phaserewarditem":[3,3],
                                "phasebonusrewarditem":[
                                                        [
                                                            ["수호석 결정",720],
                                                            ["파괴석 결정",360],
                                                            ["명예의 파편",1000],
                                                            ["위대한 명예의 돌파석",10],
                                                            ["마수의 뼈",3]
                                                        ],
                                                        [
                                                            ["수호석 결정",960],
                                                            ["파괴석 결정",480],
                                                            ["명예의 파편",1300],
                                                            ["위대한 명예의 돌파석",10],
                                                            ["마수의 뼈",3]
                                                        ]
                                                        ]
                            },
                            {
                                "bossname":"비아키스(노말)",
                                "bossitem":"욕망의 날개",
                                "phase":3,
                                "phaserewardgold":[500,600,1400],
                                "phasebonusrewardgold":[400,600,800],
                                "phaserewarditem":[1,1,1],
                                "phasebonusrewarditem":[
                                                        [
                                                            ["수호석 결정",300],
                                                            ["파괴석 결정",150],
                                                            ["명예의 파편",480],
                                                            ["위대한 명예의 돌파석",6],
                                                            ["욕망의 날개",1]
                                                        ],
                                                        [
                                                            ["수호석 결정",480],
                                                            ["파괴석 결정",240],
                                                            ["명예의 파편",600],
                                                            ["위대한 명예의 돌파석",6],
                                                            ["욕망의 날개",1]
                                                        ],
                                                        [
                                                            ["수호석 결정",600],
                                                            ["파괴석 결정",300],
                                                            ["명예의 파편",900],
                                                            ["위대한 명예의 돌파석",7],
                                                            ["욕망의 날개",1]
                                                        ]
                                                        ]
                            },
                            {
                                "bossname":"비아키스(하드)",
                                "bossitem":"욕망의 날개",
                                "phase":3,
                                "phaserewardgold":[1000,1000,2500],
                                "phasebonusrewardgold":[700,900,1200],
                                "phaserewarditem":[2,2,2],
                                "phasebonusrewarditem":[
                                                        [
                                                            ["수호석 결정",480],
                                                            ["파괴석 결정",240],
                                                            ["명예의 파편",1200],
                                                            ["위대한 명예의 돌파석",10],
                                                            ["욕망의 날개",2]
                                                        ],
                                                        [
                                                            ["수호석 결정",720],
                                                            ["파괴석 결정",360],
                                                            ["명예의 파편",1200],
                                                            ["위대한 명예의 돌파석",10],
                                                            ["욕망의 날개",2]
                                                        ],
                                                        [
                                                            ["수호석 결정",960],
                                                            ["파괴석 결정",480],
                                                            ["명예의 파편",1500],
                                                            ["위대한 명예의 돌파석",10],
                                                            ["욕망의 날개",2]
                                                        ]
                                                        ]
                            },
                            {
                                "bossname":"쿠크세이튼(노말)",
                                "bossitem":"광기의 나팔",
                                "phase":3,
                                "phaserewardgold":[1000,1000,2500],
                                "phasebonusrewardgold":[800,1000,1300],
                                "phaserewarditem":[1,2,2],
                                "phasebonusrewarditem":[
                                                        [
                                                            ["수호석 결정",600],
                                                            ["파괴석 결정",300],
                                                            ["명예의 파편",1300],
                                                            ["위대한 명예의 돌파석",12],
                                                            ["광기의 나팔",1]
                                                        ],
                                                        [
                                                            ["수호석 결정",840],
                                                            ["파괴석 결정",420],
                                                            ["명예의 파편",1300],
                                                            ["위대한 명예의 돌파석",12],
                                                            ["광기의 나팔",2]
                                                        ],
                                                        [
                                                            ["수호석 결정",1080],
                                                            ["파괴석 결정",540],
                                                            ["명예의 파편",1600],
                                                            ["위대한 명예의 돌파석",12],
                                                            ["광기의 나팔",2]
                                                        ]
                                                        ]
                            },
                            {
                                "bossname":"아브렐슈드(노말)",
                                "bossitem":"몽환의 뿔",
                                "phase":6,
                                "phaserewardgold":[2000,2500,700,800,1000,1500],
                                "phasebonusrewardgold":[400,600,700,800,900,1100],
                                "phaserewarditem":[3,4,3,4,3,5],
                                "phasebonusrewarditem":[
                                                        [
                                                            ["수호강석",160],
                                                            ["파괴강석",80],
                                                            ["명예의 파편",1400],
                                                            ["경이로운 명예의 돌파석",4],
                                                            ["몽환의 뿔",3]
                                                        ],
                                                        [
                                                            ["수호강석",200],
                                                            ["파괴강석",100],
                                                            ["명예의 파편",1600],
                                                            ["경이로운 명예의 돌파석",6],
                                                            ["몽환의 뿔",4]
                                                        ],
                                                        [
                                                            ["수호강석",200],
                                                            ["파괴강석",100],
                                                            ["명예의 파편",1400],
                                                            ["경이로운 명예의 돌파석",4],
                                                            ["몽환의 뿔",3]
                                                        ],
                                                        [
                                                            ["수호강석",280],
                                                            ["파괴강석",140],
                                                            ["명예의 파편",1600],
                                                            ["경이로운 명예의 돌파석",6],
                                                            ["몽환의 뿔",4]
                                                        ],
                                                        [
                                                            ["수호강석",360],
                                                            ["파괴강석",180],
                                                            ["명예의 파편",1700],
                                                            ["경이로운 명예의 돌파석",6],
                                                            ["몽환의 뿔",3]
                                                        ],
                                                        [
                                                            ["수호강석",480],
                                                            ["파괴강석",240],
                                                            ["명예의 파편",2400],
                                                            ["경이로운 명예의 돌파석",8],
                                                            ["몽환의 뿔",5]
                                                        ]
                                                        ]
                            },
                            {
                                "bossname":"아브렐슈드(하드)",
                                "bossitem":"몽환의 사념",
                                "phase":6,
                                "phaserewardgold":[2500,3000,900,1100,1200,1800],
                                "phasebonusrewardgold":[700,800,900,1100,1100,1400],
                                "phaserewarditem":[3,4,3,4,3,5],
                                "phasebonusrewarditem":[
                                                        [
                                                            ["수호강석",240],
                                                            ["파괴강석",120],
                                                            ["명예의 파편",1600],
                                                            ["경이로운 명예의 돌파석",8],
                                                            ["몽환의 사념",3]
                                                        ],
                                                        [
                                                            ["수호강석",360],
                                                            ["파괴강석",180],
                                                            ["명예의 파편",2000],
                                                            ["경이로운 명예의 돌파석",8],
                                                            ["몽환의 사념",4]
                                                        ],
                                                        [
                                                            ["수호강석",360],
                                                            ["파괴강석",180],
                                                            ["명예의 파편",1600],
                                                            ["경이로운 명예의 돌파석",8],
                                                            ["몽환의 사념",3]
                                                        ],
                                                        [
                                                            ["수호강석",480],
                                                            ["파괴강석",240],
                                                            ["명예의 파편",2000],
                                                            ["경이로운 명예의 돌파석",8],
                                                            ["몽환의 사념",4]
                                                        ],
                                                        [
                                                            ["수호강석",600],
                                                            ["파괴강석",300],
                                                            ["명예의 파편",2400],
                                                            ["경이로운 명예의 돌파석",10],
                                                            ["몽환의 사념",3]
                                                        ],
                                                        [
                                                            ["수호강석",900],
                                                            ["파괴강석",450],
                                                            ["명예의 파편",3000],
                                                            ["경이로운 명예의 돌파석",15],
                                                            ["몽환의 사념",5]
                                                        ]
                                                        ]
                            },
                            {
                                "bossname":"카양겔(노말)",
                                "bossitem":"",
                                "phase":['넬라시아','요람'],
                                "phaserewardgold":[0,0],
                                "phasebonusrewardgold":[400,600],
                                "phaserewarditem":[0,0],
                                "phasebonusrewarditem":[
                                                        [
                                                            ["수호석 결정",840],
                                                            ["파괴석 결정",420],
                                                            ["명예의 파편",1400],
                                                            ["위대한 명예의 돌파석",12],
                                                        ],
                                                        [
                                                            ["수호석 결정",240],
                                                            ["파괴석 결정",120],
                                                            ["명예의 파편",1600],
                                                            ["위대한 명예의 돌파석",12],
                                                        ]
                                                        ]
                            },
                            {
                                "bossname":"카양겔(하드Ⅰ)",
                                "bossitem":"",
                                "phase":['넬라시아','요람'],
                                "phaserewardgold":[0,0],
                                "phasebonusrewardgold":[700,800],
                                "phaserewarditem":[0,0],
                                "phasebonusrewarditem":[
                                                        [
                                                            ["수호강석",200],
                                                            ["파괴강석",100],
                                                            ["명예의 파편",1400],
                                                            ["경이로운 명예의 돌파석",4],
                                                        ],
                                                        [
                                                            ["수호강석",280],
                                                            ["파괴강석",140],
                                                            ["명예의 파편",1600],
                                                            ["경이로운 명예의 돌파석",6],
                                                        ]
                                                        ]
                            },
                            {
                                "bossname":"카양겔(하드Ⅱ)",
                                "bossitem":"관조의 빛무리",
                                "phase":['넬라시아','요람'],
                                "phaserewardgold":[0,0],
                                "phasebonusrewardgold":[900,1100],
                                "phaserewarditem":[1,2],
                                "phasebonusrewarditem":[
                                                        [
                                                            ["수호강석",360],
                                                            ["파괴강석",180],
                                                            ["명예의 파편",1600],
                                                            ["경이로운 명예의 돌파석",8],
                                                            ["관조의 빛무리",1]
                                                        ],
                                                        [
                                                            ["수호강석",480],
                                                            ["파괴강석",240],
                                                            ["명예의 파편",2000],
                                                            ["경이로운 명예의 돌파석",8],
                                                            ["관조의 빛무리",2]
                                                        ]
                                                        ]
                            },
                            {
                                "bossname":"카양겔(하드Ⅲ)",
                                "bossitem":"관조의 빛무리",
                                "phase":['넬라시아','요람'],
                                "phaserewardgold":[0,0],
                                "phasebonusrewardgold":[1100,1400],
                                "phaserewarditem":[2,3],
                                "phasebonusrewarditem":[
                                                        [
                                                            ["정제된 수호강석",150],
                                                            ["정제된 파괴강석",75],
                                                            ["명예의 파편",2400],
                                                            ["찬란한 명예의 돌파석",3],
                                                            ["관조의 빛무리",2]
                                                        ],
                                                        [
                                                            ["정제된 수호강석",230],
                                                            ["정제된 파괴강석",115],
                                                            ["명예의 파편",3000],
                                                            ["찬란한 명예의 돌파석",4],
                                                            ["관조의 빛무리",3]
                                                        ]
                                                        ]
                            },
                            {
                                "bossname":"일리아칸(노말)",
                                "bossitem":"쇠락한 눈동자",
                                "phase":3,
                                "phaserewardgold":[1500,1750,2250],
                                "phasebonusrewardgold":[900,1100,1500],
                                "phaserewarditem":[3,3,5],
                                "phasebonusrewarditem":[
                                                        [
                                                            ["정제된 수호강석",240],
                                                            ["정제된 파괴강석",120],
                                                            ["명예의 파편",3000],
                                                            ["찬란한 명예의 돌파석",6],
                                                            ["쇠락한 눈동자",3]
                                                        ],
                                                        [
                                                            ["정제된 수호강석",320],
                                                            ["정제된 파괴강석",160],
                                                            ["명예의 파편",3000],
                                                            ["찬란한 명예의 돌파석",8],
                                                            ["쇠락한 눈동자",3]
                                                        ],
                                                        [
                                                            ["정제된 수호강석",480],
                                                            ["정제된 파괴강석",240],
                                                            ["명예의 파편",4200],
                                                            ["찬란한 명예의 돌파석",11],
                                                            ["쇠락한 눈동자",5]
                                                        ],
                                                        ]
                            },
                            {
                                "bossname":"일리아칸(하드)",
                                "bossitem":"쇠락한 눈동자",
                                "phase":3,
                                "phaserewardgold":[1750,2000,2750],
                                "phasebonusrewardgold":[1200,1400,1900],
                                "phaserewarditem":[7,7,8],
                                "phasebonusrewarditem":[
                                                        [
                                                            ["정제된 수호강석",400],
                                                            ["정제된 파괴강석",200],
                                                            ["명예의 파편",4000],
                                                            ["찬란한 명예의 돌파석",9],
                                                            ["쇠락한 눈동자",7]
                                                        ],
                                                        [
                                                            ["정제된 수호강석",480],
                                                            ["정제된 파괴강석",240],
                                                            ["명예의 파편",4000],
                                                            ["찬란한 명예의 돌파석",12],
                                                            ["쇠락한 눈동자",7]
                                                        ],
                                                        [
                                                            ["정제된 수호강석",720],
                                                            ["정제된 파괴강석",360],
                                                            ["명예의 파편",5500],
                                                            ["찬란한 명예의 돌파석",18],
                                                            ["쇠락한 눈동자",8]
                                                        ],
                                                        ]
                            },
                        ];
    var bossColor = {"아르고스":"#ffffff", "발탄":"#5f9ea0", "비아키스":"#ff1493", "쿠크세이튼":"#ff703b", "아브렐슈드":"#8a2be2", "카양겔":"#ffd700", "일리아칸":"#006400"}
    
    var content = "";

    var marketdata = {}
    var iteminfo = {
                        "수호석 결정":10,
                        "파괴석 결정":10,
                        "명예의 파편":1,
                        "위대한 명예의 돌파석":1,
                        "수호강석":10,
                        "파괴강석":10,
                        "경이로운 명예의 돌파석":1,
                        "정제된 수호강석":10,
                        "정제된 파괴강석":10,
                        "찬란한 명예의 돌파석":1
                    };
    document.addEventListener("DOMContentLoaded", function(){
        fetch(url + '/rewardcalc', {method: 'POST'}).then((response) => response.json()).then((data) =>{
            data['명예의 파편'] = data['명예의 파편 주머니(대)']/1500;

            marketdata = data;

            datatime = data['date'];
            db_year = datatime.slice(0,4);
            db_mon = datatime.slice(4,6);
            db_day = datatime.slice(6,8);
            db_hour = datatime.slice(8,10);
            db_min = datatime.slice(10,12);
            document.querySelector('#date').innerText = db_year + "-" + db_mon + "-" + db_day + " " + db_hour + ":" + db_min;

            calcreward();
        })
    });

    function calcreward(){
        target = document.querySelector('#bossaccordion');
        while (target.hasChildNodes()) {
            target.removeChild(target.firstChild);
        }

        reward_bonus_array.forEach(function(boss, index){
            content = 
`
<div class="accordion-item">
<h2 class="accordion-header" id="heading${index}">
<button class="accordion-button collapsed fw-bold" type="button" style="color:${bossColor[boss['bossname'].substring(0, boss['bossname'].indexOf('('))]}" data-bs-target="#collapse${index}" aria-controls="collapse${index}" data-bs-toggle="collapse" aria-expanded="false">
    ${boss['bossname']}
</button>
</h2>
<div id="collapse${index}" class="accordion-collapse collapse" aria-labelledby="heading${index}" data-bs-parent="#bossaccordion">
<div class="accordion-body p-0">
    <table class="table table-dark table-hover mb-0">
    <thead>
        <tr>
        <th scope="col">관문</th>
        <th scope="col">획득 골드</th>
        <th scope="col">더보기 비용</th>
        <th scope="col">기본 보상</th>
        <th scope="col">더보기 보상</th>
        <th scope="col">/</th>
        <th scope="col">이익</th>
        </tr>
    </thead>
`;
        if(Array.isArray(boss['phase'])){
            var phasecount = boss['phase'].length;
        }else{
            var phasecount = boss['phase'];
        }

        for (var i = 0; i < phasecount; i++) {
            content += 
`
    <tbody class="align-middle">
        <tr>
`;
            if(Array.isArray(boss['phase'])){
                content += '<th scope="row">' + boss['phase'][i]; + '</th>'
            }else{
                content += '<th scope="row">' + String(i+1) + '관문'; + '</th>'
            }

            content +=
`
            <td>
                <span id="cleargold">${boss['phaserewardgold'][i]}</span><span><img src="img/gold.png" class="ms-1 img-gold"></span>
            </td>
            <td>
                <span id="bonusgold">${boss['phasebonusrewardgold'][i]}</span><span><img src="img/gold.png" class="ms-1 img-gold"></span>
            </td>
`;
            if(boss['bossitem'] != ""){
                content +=
`
            <td>
                <span>${boss['bossitem']} </span>${boss['phaserewarditem'][i]}<span>개</span>
            </td>
`;
            }else{
                content +=
`
            <td></td>
`;
            }
                content += 
`
            <td>
`;
            for (var j = 0; j < boss['phasebonusrewarditem'][i].length; j++) {
                content += `<p><span id="rewarditemname">${boss['phasebonusrewarditem'][i][j][0]}</span> × <span id="rewarditemqty">${boss['phasebonusrewarditem'][i][j][1]}</span></p>`;
            }
            content += 
`
            </td>
            <td>
`;
            totalbonusrewardgold = 0;
            for (var j = 0; j < boss['phasebonusrewarditem'][i].length; j++) {
                if(filteritemlist.includes(boss['phasebonusrewarditem'][i][j][0])){
                    content += `<p>　</p>`;
                    continue;
                }
                if(boss['bossitem'] == boss['phasebonusrewarditem'][i][j][0]){
                    if(filteritemlist.includes('혼돈의 돌')){
                        content += `<p>　</p>`;
                        continue;
                    }
                    content += `<p><span id="rewarditemname">100</span> × <span id="rewarditemqty">${boss['phasebonusrewarditem'][i][j][1]}</span> = <span>${parseInt(100 * boss['phasebonusrewarditem'][i][j][1])}</span></p>`;
                    totalbonusrewardgold += (100 * boss['phasebonusrewarditem'][i][j][1]);
                    continue;
                }

                tempA = marketdata[boss['phasebonusrewarditem'][i][j][0]];
                tempB = boss['phasebonusrewarditem'][i][j][1] / iteminfo[boss['phasebonusrewarditem'][i][j][0]];
                tempcalc = tempA * tempB;

                tempAtoShow = tempA;
                if(boss['phasebonusrewarditem'][i][j][0].indexOf("의 파편") != -1){
                    tempAtoShow = tempA.toFixed(3);
                }

                content += `<p><span id="rewarditemname">${tempAtoShow}</span> × <span id="rewarditemqty">${tempB}</span> = <span>${parseInt(tempcalc)}</span></p>`;
                totalbonusrewardgold += tempcalc;
            }
            content +=
`
            </td>
            <td class="fw-bold">
            <p><span>${parseInt(totalbonusrewardgold)}</span><span> - </span><span>${boss['phasebonusrewardgold'][i]}</span><span> = </span></span></p>
`;
            tempresult = parseInt(totalbonusrewardgold) - boss['phasebonusrewardgold'][i];
            temptextcolor = "#00ff00";
            if(tempresult <= 0){
                temptextcolor = "#ff6b6b";
            }
            content +=
`
            <p><span style="color:${temptextcolor}">${tempresult}</span><span><img src="img/gold.png" class="ms-1 img-gold"></span></p>
`;
            content +=
`
            </td>
        </tr>
    </tbody>
`;
        }
        
        content +=
`
    </table>
</div>
</div>
</div>
`;
        document.querySelector('#bossaccordion').innerHTML += content;
        })
    }

    var filteritemlist = ['혼돈의 돌']
    document.querySelector('#itemaccordion').querySelectorAll('td').forEach((e)=>{
        e.addEventListener('click', (td)=>{
            if(td.target.className == "form-check-label" || td.target.className == "btn btn-outline-light btn-lg") return;
            try{
                if(td.target.querySelector('.form-check-input').checked){
                    td.target.querySelector('.form-check-input').checked = false;
                }else{
                    td.target.querySelector('.form-check-input').checked = true;
                }
            }catch{}

            filteritemlist = []
            document.querySelector('#itemaccordion').querySelectorAll('.form-check-input').forEach((e)=>{
                if(e.checked){
                    filteritemlist.push(e.value)
                }
            });
            calcreward();
        });
    });


    document.querySelector('#itemaccordion').querySelectorAll('.btn-outline-light').forEach((e)=>{
        e.addEventListener('click', (button)=>{
            if(button.target.id == "allcheck"){
                document.querySelector('#itemaccordion').querySelectorAll('.form-check-input').forEach((f)=>{
                    f.checked = true;
                });
            }else{
                document.querySelector('#itemaccordion').querySelectorAll('.form-check-input').forEach((f)=>{
                    f.checked = false;
                });
            }
            
            filteritemlist = []
            document.querySelector('#itemaccordion').querySelectorAll('.form-check-input').forEach((e)=>{
                if(e.checked){
                    filteritemlist.push(e.value)
                }
            });
            calcreward();
        });
    });